-- Tworzenie bazy danych
CREATE DATABASE CertDB;
GO

USE CertDB;
GO

-- Tabela: Clients
CREATE TABLE Clients (
    Id INT IDENTITY(1,1) PRIMARY KEY,
    FirstName NVARCHAR(100) NOT NULL,
    LastName NVARCHAR(100) NOT NULL,
    Email NVARCHAR(255) NOT NULL,
    PhoneNumber NVARCHAR(20),
    CreatedAt DATETIME NOT NULL DEFAULT GETDATE()
);

-- Tabela: CertificateTypes
CREATE TABLE CertificateTypes (
    Id INT IDENTITY(1,1) PRIMARY KEY,
    Name NVARCHAR(100) NOT NULL,
    DefaultValidityMonths INT NOT NULL
);

-- Tabela: Certificates
CREATE TABLE Certificates (
    Id INT IDENTITY(1,1) PRIMARY KEY,
    ClientId INT NOT NULL FOREIGN KEY REFERENCES Clients(Id),
    TypeId INT NOT NULL FOREIGN KEY REFERENCES CertificateTypes(Id),
    IssueDate DATE NOT NULL,
    ExpirationDate DATE NOT NULL,
    IsActive BIT NOT NULL
);

-- Tabela: NotificationLogs
CREATE TABLE NotificationLogs (
    Id INT IDENTITY(1,1) PRIMARY KEY,
    CertificateId INT NOT NULL FOREIGN KEY REFERENCES Certificates(Id),
    Channel NVARCHAR(20) NOT NULL,
    SentDate DATETIME NOT NULL,
    MessageContent NVARCHAR(MAX),
    Status NVARCHAR(50) NOT NULL
);

-- Przykładowe dane: Clients
INSERT INTO Clients (FirstName, LastName, Email, PhoneNumber)
VALUES
('Jan', 'Kowalski', 'jan.kowalski@example.com', '500111222'),
('Anna', 'Nowak', 'anna.nowak@example.com', '500333444'),
('Piotr', 'Wiśniewski', 'piotr.wisniewski@example.com', '500555666');

-- Przykładowe dane: CertificateTypes
INSERT INTO CertificateTypes (Name, DefaultValidityMonths)
VALUES
('BHP', 12),
('SEP', 24),
('Pierwsza pomoc', 36);

-- Przykładowe dane: Certificates
INSERT INTO Certificates (ClientId, TypeId, IssueDate, ExpirationDate, IsActive)
VALUES
(1, 1, '2024-01-10', '2025-01-10', 1),
(1, 2, '2023-06-01', '2025-06-01', 1),
(2, 1, '2023-03-15', '2024-03-15', 0),
(2, 3, '2022-09-01', '2025-09-01', 1),
(3, 2, '2024-02-20', '2026-02-20', 1);

-- Przykładowe dane: NotificationLogs
INSERT INTO NotificationLogs (CertificateId, Channel, SentDate, MessageContent, Status)
VALUES
(1, 'Email', GETDATE(), 'Twój certyfikat BHP wkrótce wygaśnie.', 'Sent'),
(2, 'SMS', GETDATE(), 'Certyfikat SEP wygasa za 30 dni.', 'Sent'),
(3, 'Email', GETDATE(), 'Certyfikat BHP wygasł.', 'Sent');